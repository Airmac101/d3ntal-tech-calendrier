<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendrier Collaboratif</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <div class="calendar-header">
            <button class="nav-btn" onclick="window.location.href='{{ url_for('calendar_view', year=prev_year, month=prev_month) }}'">Précédent</button>
            <h2>{{ month_name }} {{ year }}</h2>
            <button class="nav-btn" onclick="window.location.href='{{ url_for('calendar_view', year=next_year, month=next_month) }}'">Suivant</button>
        </div>

        <table class="calendar-table">
            <thead>
                <tr>
                    <th>Lun</th>
                    <th>Mar</th>
                    <th>Mer</th>
                    <th>Jeu</th>
                    <th>Ven</th>
                    <th>Sam</th>
                    <th>Dim</th>
                </tr>
            </thead>
            <tbody>
                {% for week in calendar_days|batch(7) %}
                    <tr>
                        {% for day in week %}
                            <td class="calendar-day {% if day.day %}has-event{% endif %}">
                                {% if day.day %}
                                    <a href="#" class="day-link" onclick="openEventForm({{ day.day }})">{{ day.day }}</a>
                                {% else %}
                                    <span>&nbsp;</span>
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Event Creation Form -->
        <div id="eventForm" class="event-form">
            <h3>Créer un événement</h3>
            <form method="POST">
                <input type="date" name="event_date" id="event_date" required>
                <input type="time" name="event_time" id="event_time" required>
                <input type="text" name="event_title" id="event_title" placeholder="Objet / Titre de l'événement" required>
                <textarea name="event_notes" id="event_notes" placeholder="Détails supplémentaires (optionnel)"></textarea>

                <label for="collaborators">Choisissez un ou plusieurs collaborateurs:</label>
                <select name="collaborators" id="collaborators" multiple required>
                    {% for user in all_users %}
                        <option value="{{ user }}">{{ user }}</option>
                    {% endfor %}
                </select>

                <button type="submit" class="submit-btn">Créer l'événement</button>
            </form>
        </div>
    </div>

    <script>
        function openEventForm(day) {
            document.getElementById("eventForm").style.display = "block";
            document.getElementById("event_date").value = "{{ year }}-" + ("0" + "{{ month }}").slice(-2) + "-" + ("0" + day).slice(-2);
        }
    </script>
</body>
</html>
