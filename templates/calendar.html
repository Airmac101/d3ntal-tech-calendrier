<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calendrier</title>
    <link rel="stylesheet" href="/static/style_v2.css">
</head>
<body>

    <!-- TOP BAR -->
    <div class="top-bar">
        <div class="logo">D3NTAL-TECH â€” Calendrier</div>
        <a href="/logout" class="logout-btn">DÃ©connexion</a>
    </div>

    <!-- CALENDAR WRAPPER -->
    <div class="calendar-container">

        <!-- HEADER / NAV -->
        <div class="calendar-header">
            <button class="btn-nav" onclick="window.location='?year={{ prev_year }}&month={{ prev_month }}'">âŸµ PrÃ©cÃ©dent</button>

            <div class="month-title-wrapper">
                <h2 class="month-title">{{ month_name }} {{ year }}</h2>
                <a class="btn-export-inline" href="/export_pdf" target="_blank">
                    <button class="btn-nav" style="background:#0c6efd;">ðŸ“„ Export PDF</button>
                </a>
            </div>

            <button class="btn-nav" onclick="window.location='?year={{ next_year }}&month={{ next_month }}'">Suivant âŸ¶</button>

            <button id="addEventBtn" class="btn-add">+ Ajouter un Ã©vÃ¨nement</button>
        </div>

        <!-- CALENDAR TABLE -->
        <table class="calendar-table">
            <thead>
                <tr>
                    <th>Lundi</th>
                    <th>Mardi</th>
                    <th>Mercredi</th>
                    <th>Jeudi</th>
                    <th>Vendredi</th>
                    <th>Samedi</th>
                    <th>Dimanche</th>
                </tr>
            </thead>
            <tbody>
                {% for week in calendar_days %}
                <tr>
                    {% for day in week %}
                    <td class="day-cell {% if day == current_day %}today{% endif %}"
                        data-date="{{ day.isoformat() }}">
                        
                        <div class="day-number">{{ day.day }}</div>

                        <div class="events-container">
                            {% for ev in events_by_date[day.isoformat()] %}
                            <div class="event-item {{ ev.css_class }}"
                                 data-event-id="{{ ev.id }}">
                                
                                {% if ev.all_day %}
                                    ðŸ•˜ JournÃ©e entiÃ¨re â€” {{ ev.title }}
                                {% else %}
                                    {{ ev.time }} â€” {{ ev.title }}
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>

                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>

    </div>

    <!-- MONTH SUMMARY -->
    <div class="summary-container">
        <h3>RÃ©sumÃ© du mois</h3>
        {% for date_key, ev_list in events_by_date.items() %}
            {% if ev_list %}
                <p><strong>{{ date_key }} :</strong></p>
                {% for ev in ev_list %}
                    <p>â€¢ 
                        {% if ev.all_day %}
                            JournÃ©e entiÃ¨re â€” 
                        {% else %}
                            {{ ev.time }} â€” 
                        {% endif %}
                        {{ ev.title }} (<em>{{ ev.type }}</em>)
                    </p>
                {% endfor %}
            {% endif %}
        {% endfor %}
    </div>

    <!-- MODAL -->
    <div id="eventModal" class="modal">
        <div class="modal-content">

            <span class="close">&times;</span>

            <h3 id="modalTitle">Nouvel Ã©vÃ¨nement</h3>

            <form id="eventForm">

                <!-- DATE -->
                <label for="eventDate">Date :</label>
                <input type="date" id="eventDate" required>

                <!-- HEURE -->
                <label for="eventTime">Heure :</label>
                <input type="time" id="eventTime">

                <!-- ALL DAY -->
                <label style="margin-top:10px;">
                    <input type="checkbox" id="eventAllDay">
                    JournÃ©e entiÃ¨re
                </label>

                <!-- TYPE (SELECT) -->
                <label for="eventType">Type :</label>
                <select id="eventType">
                    <option value="rdv">RDV</option>
                    <option value="reunion">RÃ©union</option>
                    <option value="admin">Administratif</option>
                    <option value="urgence">Urgence</option>
                    <option value="formation">Formation</option>
                    <option value="autre">Autre</option>
                </select>

                <!-- TITLE -->
                <label for="eventTitle">Titre :</label>
                <input type="text" id="eventTitle" required>

                <!-- COLLABORATORS -->
                <label for="eventCollab">Collaborateurs :</label>
                <input type="text" id="eventCollab">

                <!-- NOTES -->
                <label for="eventNotes">Notes :</label>
                <textarea id="eventNotes"></textarea>

                <!-- PRIORITÃ‰ -->
                <label for="eventPriority">PrioritÃ© :</label>
                <select id="eventPriority">
                    <option value="basse">Basse</option>
                    <option value="normale" selected>Normale</option>
                    <option value="haute">Haute</option>
                </select>

                <!-- BUTTONS -->
                <button type="button" class="btn-save" id="saveBtn">ðŸ’¾ Enregistrer</button>
                <button type="button" class="btn-delete" id="deleteBtn" style="display:none;">ðŸ—‘ Supprimer</button>

            </form>

        </div>
    </div>

    <script src="/static/calendar.js"></script>
</body>
</html>
