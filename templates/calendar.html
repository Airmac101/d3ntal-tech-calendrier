<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>Calendrier D3NTAL TECH</title>
    <link rel="stylesheet" href="/static/style_v2.css" />
    <script src="/static/calendar.js" defer></script>
</head>

<body>

<!-- TOP BAR -->
<div class="top-bar">
    <div class="logo">D3NTAL TECH â€” Calendrier</div>
    <a class="logout-btn" href="/logout">DÃ©connexion</a>
</div>

<!-- CALENDAR CONTAINER -->
<div class="calendar-container">

    <!-- HEADER / MONTH NAV -->
    <div class="calendar-header">

        <!-- Previous month -->
        <a class="btn-nav"
           href="/calendar?year={{ prev_year }}&month={{ prev_month }}">â—€</a>

        <!-- Month title -->
        <div class="month-title-wrapper">
            <h2>{{ month_name }} {{ year }}</h2>

            <!-- ðŸ“Š EXPORT EXCEL BUTTON -->
            <a class="btn-excel"
               href="/export_excel?year={{ year }}&month={{ month }}">
                ðŸ“Š Export Excel
            </a>
        </div>

        <!-- Next month -->
        <a class="btn-nav"
           href="/calendar?year={{ next_year }}&month={{ next_month }}">â–¶</a>
    </div>

    <!-- CALENDAR TABLE -->
    <table class="calendar-table">
        <thead>
            <tr>
                <th>Lundi</th>
                <th>Mardi</th>
                <th>Mercredi</th>
                <th>Jeudi</th>
                <th>Vendredi</th>
                <th>Samedi</th>
                <th>Dimanche</th>
            </tr>
        </thead>

        <tbody>
        {% for week in calendar_days %}
            <tr>
                {% for day in week %}
                    {% set iso = day.isoformat() %}
                    <td class="day-cell {% if day == current_day %}today{% endif %}"
                        data-date="{{ iso }}">

                        <div class="day-number">{{ day.day }}</div>

                        <div class="events-container">
                            {% if events_by_date.get(iso) %}
                                {% for ev in events_by_date[iso] %}
                                    <div class="event-item {{ ev.css_class }}"
                                         data-id="{{ ev.id }}">
                                        {{ ev.time }} â€” {{ ev.title }}
                                    </div>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </td>
                {% endfor %}
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<!-- SUMMARY -->
<div class="summary-container">
    <h3>RÃ©capitulatif du mois</h3>

    {% for d_iso, block in week_summary.items() %}
        <p><strong>{{ block.date }}</strong></p>
        {% for ev in block.events %}
            <p>
                {{ ev.time }} â€” <em>{{ ev.type }}</em> â€” {{ ev.title }}
                {% if ev.notes %}
                    <br><span style="font-size:12px; color:#666;">Notes : {{ ev.notes }}</span>
                {% endif %}
            </p>
        {% endfor %}
        <hr>
    {% endfor %}
</div>


<!-- MODAL -->
<div id="eventModal" class="modal">
    <div class="modal-content">
        <span class="close">Ã—</span>
        <h2 id="modalTitle">Nouvel Ã©vÃ©nement</h2>

        <form id="eventForm">

            <label for="title">Titre</label>
            <input type="text" id="title" name="title" required />

            <label for="event_date">Date</label>
            <input type="date" id="event_date" name="event_date" required />

            <label for="event_time">Heure</label>
            <input type="time" id="event_time" name="event_time" required />

            <label for="event_type">Type</label>
            <select id="event_type" name="event_type" required>
                <option value="rdv">RDV</option>
                <option value="reunion">RÃ©union</option>
                <option value="admin">Admin</option>
                <option value="urgence">Urgence</option>
                <option value="formation">Formation</option>
                <option value="autre">Autre</option>
            </select>

            <label for="collaborators">Collaborateurs</label>
            <input type="text" id="collaborators" />

            <label for="priority">PrioritÃ©</label>
            <select id="priority">
                <option value="Normal">Normal</option>
                <option value="Haute">Haute</option>
                <option value="Critique">Critique</option>
            </select>

            <label for="notes">Notes</label>
            <textarea id="notes"></textarea>

            <button type="submit" class="btn-save">Enregistrer</button>
            <button type="button" id="deleteBtn" class="btn-delete"
                    style="display:none;">
                Supprimer
            </button>
        </form>
    </div>
</div>

</body>
</html>
