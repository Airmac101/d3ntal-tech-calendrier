<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Calendrier ‚Äî D3NTAL TECH</title>
    <link rel="stylesheet" href="/static/style_v2.css">
</head>
<body>

<div class="top-bar">
    <div class="logo">D3NTAL TECH</div>
    <a class="logout-btn" href="/logout">D√©connexion</a>
</div>

<div class="calendar-container">

    <!-- NAVIGATION FIX√âE (version stable d'origine + ajout du bouton PDF) -->
    <div class="calendar-nav">

        <!-- Mois pr√©c√©dent -->
        <a href="/calendar?year={{ prev_year }}&month={{ prev_month }}" class="btn-nav">
            ‚Üê Mois pr√©c√©dent
        </a>

        <!-- Titre central -->
        <h2 class="month-title">{{ month_name }} {{ year }}</h2>

        <!-- Zone actions √† droite -->
        <div class="calendar-actions">

            <!-- Bouton Export PDF (Premium Notion) -->
            <a href="/export_pdf" class="btn-export">
                üìÑ Export PDF
            </a>

            <!-- Ajouter √©v√©nement -->
            <button id="addEventBtn" class="btn-add">
                + Ajouter un √©v√©nement
            </button>

            <!-- Mois suivant -->
            <a href="/calendar?year={{ next_year }}&month={{ next_month }}" class="btn-nav">
                Mois suivant ‚Üí
            </a>

        </div>
    </div>

    <!-- TABLEAU DU CALENDRIER (inchang√©, version stable) -->
    <table class="calendar-table">
        <thead>
            <tr>
                <th>Lundi</th>
                <th>Mardi</th>
                <th>Mercredi</th>
                <th>Jeudi</th>
                <th>Vendredi</th>
                <th>Samedi</th>
                <th>Dimanche</th>
            </tr>
        </thead>

        <tbody>
        {% for week in calendar_days %}
            <tr>
                {% for d in week %}
                    <td class="day-cell {% if d == current_day %}today{% endif %}"
                        data-date="{{ d }}">

                        <div class="day-number">{{ d.day }}</div>

                        {% if events_by_date[d.isoformat()] %}
                            <div class="events-container">
                                {% for ev in events_by_date[d.isoformat()] %}
                                    <div class="event-item {{ ev.css_class }}">
                                        <strong>{{ ev.title }}</strong><br>
                                        <span>{{ ev.type }}</span><br>
                                        <small>‚Äî {{ ev.collaborators }}</small>
                                    </div>
                                {% endfor %}
                            </div>
                        {% endif %}

                    </td>
                {% endfor %}
            </tr>
        {% endfor %}
        </tbody>
    </table>

</div>

<!-- R√âCAPITULATIF DU MOIS (inchang√©) -->
<div class="summary-container">
    <h3>R√©capitulatif du mois : {{ week_start.strftime('%d/%m/%Y') }} ‚Üí {{ week_end.strftime('%d/%m/%Y') }}</h3>

    {% if week_summary %}
        {% for d, info in week_summary.items() %}
            <p>
                <strong>{{ info.date.strftime('%A %d %B').capitalize() }} :</strong>

                {% for ev in info.events %}
                    <span style="color:red; font-weight:bold;">
                        {% if ev.priority.lower() == "urgent" %}[URGENT]{% endif %}
                    </span>

                    {{ ev.time }} ‚Äî {{ ev.type }} ‚Äî {{ ev.title }} ({{ ev.collab }}) ‚Äî
                    <em>{{ ev.notes }}</em>

                    {% if not loop.last %} ‚Äî {% endif %}
                {% endfor %}
            </p>
        {% endfor %}
    {% else %}
        <p>Aucun √©v√©nement enregistr√© pour ce mois.</p>
    {% endif %}
</div>

<!-- JS du calendrier -->
<script src="/static/calendar.js"></script>

</body>
</html>
